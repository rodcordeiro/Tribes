# Repository Guidelines

## Project Description
Tribes is an autonomous tribal strategy game inspired by Civilization. At startup, the game generates a board and spawns 4 tribes. On each tick (initially 1s), tribes interact with the world and with each other through a decision engine that can choose to move across the map, stay put, ally with other tribes, or go to war. Tribes that reach high population and resource thresholds can split into new tribes. The application is currently at version 1.1.0, and each release will add new functionality.

Current features (v1.1.0):
- Procedural board generation at initialization.
- Spawn of 4 tribes at game start.
- Tick-based simulation loop with initial tick duration of 1s.
- Decision engine actions: move, stay, ally, or declare war.
- Tribe splitting based on population and resource thresholds.
- Tribes have a core (war, peace, exploration) that influences decisions, with archetypes per core that shape movement, stability, and production preferences.
- Each tribe receives a random core and archetype, with a 2% chance per tick to change core (and archetype) dynamically.
- Flee movement validates board bounds to prevent tribes from leaving the map.
- Tiles keep a fading memory of wars (10 ticks) that peace tribes avoid, with a red overlay and productivity impact on adjacent tiles.
- Cities can be founded on suitable tiles and grow over time when occupied.
- Battles on city tiles can lead to conquest or raids that steal supplies and reduce city population.
- Tribes can build basic road infrastructure that boosts local production and is visible on tiles.

## Project Structure & Module Organization
- `src/app` contains Expo Router routes and layouts (e.g., `_layout.tsx`, `+not-found.tsx`, route groups like `(tabs)`).
- `src/components`, `src/screens`, `src/contexts`, `src/stores`, and `src/common` hold shared UI, screens, state, and utilities.
- `src/assets` stores images and other static assets.
- `src/@types` holds shared TypeScript declarations.
- `android/` is the native Android project generated by Expo prebuild.
- Path alias: `@/` maps to `src` (see `tsconfig.json`).

## Build, Test, and Development Commands
- `pnpm start` starts the Expo dev client (`expo start --dev-client`).
- `pnpm android` runs the Android app on a device/emulator.
- `pnpm ios` runs the iOS app (requires macOS).
- `pnpm web` starts the web build.
- `pnpm prebuild` regenerates native projects from Expo config.
- `pnpm build:dev`, `pnpm build:preview`, `pnpm build:prod` run EAS builds for each profile.
- `pnpm lint` checks ESLint + Prettier formatting.
- `pnpm format` fixes ESLint issues and formats with Prettier.
- `pnpm release` runs `commit-and-tag-version` to update the changelog.

## Coding Style & Naming Conventions
- Indentation: 2 spaces, `singleQuote: true`, `printWidth: 100`, `trailingComma: es5`.
- Use Tailwind classes in `className`; Prettier sorts them via `prettier-plugin-tailwindcss`.
- Follow Expo Router file conventions in `src/app` for routes and layouts.

## Testing Guidelines
- No test runner or test scripts are configured yet.
- Add a test framework and a `test` script before introducing test files.

## Commit & Pull Request Guidelines
- Use Conventional Commits (e.g., `feat: add onboarding screen`, `fix: handle null user`).
- PRs should include a brief description. Screenshots are optional and encouraged for UI changes.
- Changelog updates are managed via `commit-and-tag-version` and saved to `CHANGELOG.md`.
- Husky runs `lint-staged` on `pre-commit` to enforce formatting/lint on staged files.
- After every change, run `pnpm release` to increment the version, and update `AGENTS.md` with the correct version.

## Configuration Notes
- Key config files: `app.json`, `eas.json`, `eslint.config.js`, `prettier.config.js`, `tailwind.config.js`.
- EAS build commands require EAS CLI auth and appropriate profile setup.
